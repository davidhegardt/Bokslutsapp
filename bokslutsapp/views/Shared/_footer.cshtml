@model IEnumerable<Bokslutsapp.Models._1930Bank>
@{
    ViewBag.Bilaga = "1";
    ViewBag.Konto = "2510";
    ViewBag.Title = "Skatteberäkning";
    ViewBag.Company = "Företag AB";
    ViewBag.OrgNr = "556800-5000";
    ViewBag.FiscalYear = "2017-01-01 - 2017-12-31";
    ViewBag.VerNr = "1";

    ViewBag.testsumma = "786503,79";
    ViewBag.testdiff = "0";
    ViewBag.avskiljare = ", ";
    ViewBag.testskatt = "22%";
    ViewBag.testver = "1";
}

<style>
    .table input {
        width: 100%;
        height: 25px;
        border: none;
        text-align: right;
        background: transparent;
    }
    .table input[class="BFkonto"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: center;
        background: transparent;
    }
    .table input[class="BFkontonamn"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: left;
        background: transparent;
    }
    .table input[class="BFks"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: center;
        background: transparent;
    }
    .table input[class="BFpr"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: center;
        background: transparent;
    }
    .table input[class="BFrad"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: right;
        background: transparent;
    }
</style>

<!--KONTERINGSFÄLT-->
<table id="kontering" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th colspan="2"><strong>Bokföringsorder</strong></th>
            <td colspan="1" width="10%" contenteditable='true'><strong>Datum</strong></td>
            <td colspan="1" width="10%" contenteditable='true'><strong></strong></td>
            <th colspan="1"><strong>Text:</strong></th>
            <td colspan="3" width="40%" contenteditable='true'><strong></strong></td>
            <th colspan="2" >Vernr</th>
            <th colspan="2">@ViewBag.testver</th>
        </tr>
        <tr>
            <th colspan="2" width="15%">Konto</th>
            <th colspan="6" width="60%">Kontonamn</th>
            <th colspan="1" width="5%">Ks</th>
            <th colspan="1" width="5%">Pr</th>
            <th colspan="2" width="15%">Belopp</th>
        </tr>
    </thead>
    <tbody id="konteringsrader">        
        <tr class="mall">
@using (Html.BeginForm())
{
            @*<td colspan="2"><input type="text" class="BFkonto" onchange="kontoValidering(this.value)" /></td>*@            
            <td colspan="2">@Html.EditorFor(m => m.First().Konto, new { htmlAttributes = new { @class = "form-control" } })</td>        
}
            <td colspan="6"><input type="text" class="BFkontonamn" size="1000"/></td>
            <td colspan="1"><input type="text" class="BFks" /></td>
            <td colspan="1"><input type="text" class="BFpr" /></td>
            <td colspan="2"><input type="text" class="BFrad" onchange="value=talformat_2dec(this.value)" /></td>
        </tr>
    </tbody>
    <tr>
        <td colspan="10" align="right" contenteditable='false'><strong>Diff</strong></td>
        <td colspan="2"><strong><input id="BFdiff" type="text" readonly="readonly" /></strong></td>
    </tr>

</table>

<div id="Meddelande"></div>

<p align="right">
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-trash" data-toggle="tooltip" title="Radera bokföringsorder"></span>
    </a>
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-menu-left" data-toggle="tooltip" title="Föregående bokning"></span>
    </a>
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-menu-right" data-toggle="tooltip" title="Nästa bokning"></span>
    </a>
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-floppy-disk" data-toggle="tooltip" title="Registrera bokning"></span>
    </a>
</p>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<script src="~/Scripts/generella.funktioner.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script>
    $(document).ready(function () {
        //iterate through each textboxes and add keyup
        //handler to trigger sum event
        konteringsrader_init();

        $('.BFrad').each(function () {
            $(this).keyup(function () {
                var temp = calcSum(".BFrad");
                $("#BFdiff").val(talformat_2dec(temp));
            });
        });

        $("#Konto").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/Home/Huvudbok/Index",
                    type: "POST",
                    dataType: "json",
                    data: { Prefix: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { label: item.Konto, value: item.Konto };
                        }))

                    }
                })
            },
            messages: {
                noResults: "", results: ""
            }
        });

    });
    
    function konteringsrader_init() { //Funktion som vid initieringen lägger till 4 rader.
        for (var i = 0; i < 3; i++) {
            addKonteringsrad()
        }
    }

    function addKonteringsrad() { //Funktion för att skapa nya konteringsrader
        var klon = $('.mall:last').clone();
        klon.find('input[type=text]').val(null);
        $('#konteringsrader').append(klon);  
        calcSum(".BFrad");
    }
  
</script>

