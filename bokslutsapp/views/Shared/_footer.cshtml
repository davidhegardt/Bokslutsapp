@{
    ViewBag.Bilaga = "1";
    ViewBag.Konto = "2510";
    ViewBag.Title = "Skatteberäkning";
    ViewBag.Company = "Företag AB";
    ViewBag.OrgNr = "556800-5000";
    ViewBag.FiscalYear = "2017-01-01 - 2017-12-31";
    ViewBag.VerNr = "1";

    ViewBag.testsumma = "786503,79";
    ViewBag.testdiff = "0";
    ViewBag.avskiljare = ", ";
    ViewBag.testskatt = "22%";
    ViewBag.testver = "1";
}

<style>
    .table input {
        width: 100%;
        height: 25px;
        border: none;
        text-align: right;
        background: transparent;
    }
    .table input[class="BFkonto"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: center;
        background: transparent;
    }
    .table input[class="BFkontonamn"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: left;
        background: transparent;
    }
    .table input[class="BFks"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: center;
        background: transparent;
    }
    .table input[class="BFpr"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: center;
        background: transparent;
    }
    .table input[class="BFrad"] {
        width: 100%;
        height: 25px;
        border: none;
        text-align: right;
        background: transparent;
    }
</style>

<!--KONTERINGSFÄLT-->
<table id="kontering" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th colspan="2"><strong>Bokföringsorder</strong></th>
            <th colspan="1"><strong>Text:</strong></th>
            <td colspan="5" width="60%" contenteditable='true'><strong></strong></td>
            <th colspan="2" align="center">Vernr</th>
            <th colspan="2">@ViewBag.testver</th>
        </tr>
        <tr>
            <th colspan="2" width="15%">Konto</th>
            <th colspan="6" width="60%">Kontonamn</th>
            <th colspan="1" width="5%">Ks</th>
            <th colspan="1" width="5%">Pr</th>
            <th colspan="2" width="15%">Belopp</th>
        </tr>
    </thead>
    <tbody id="konteringsrader">
        <tr class="mall">
            <td colspan="2"><input type="text" class="BFkonto" onchange="kontoValidering(this.value)" /></td>
            <td colspan="6"><input type="text" class="BFkontonamn"/></td>
            <td colspan="1"><input type="text" class="BFks" /></td>
            <td colspan="1"><input type="text" class="BFpr" /></td>
            <td colspan="2"><input type="text" class="BFrad" onchange="value=Talformat(this.value)" /></td>
        </tr>
    </tbody>
    <tr>
        <td colspan="10" align="right" contenteditable='false'><strong>Diff</strong></td>
        <td colspan="2"><strong><input id="BFdiff" type="text" readonly="readonly" /></strong></td>
    </tr>

</table>

<div id="Meddelande"></div>

<p align="right">
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-trash" data-toggle="tooltip" title="Radera bokföringsorder"></span>
    </a>
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-menu-left" data-toggle="tooltip" title="Föregående bokning"></span>
    </a>
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-menu-right" data-toggle="tooltip" title="Nästa bokning"></span>
    </a>
    <a href="#" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-floppy-disk" data-toggle="tooltip" title="Registrera bokning"></span>
    </a>
</p>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js">
</script>
<script>
    $(document).ready(function () {
        //iterate through each textboxes and add keyup
        //handler to trigger sum event
        konteringsrader_init();

        $('.BFrad').each(function () {
            $(this).keyup(function () {
                calcSum(".BFrad");
            });
        });

    });

    var test = "Test";

    function Talformat(belopp) { //Funktion för att formattera tusentalsseparation
        return (parseFloat(belopp).toLocaleString("se", { minimumFractionDigits: 2, maximumFractionDigits: 3 }));
    }

    function Beräkningsformat(belopp) { //Funktion för att omvandla talrepresentationen till float
        var temp = belopp.replace(",", ".");
        return temp.replace(/\s+/g, '');
    } 

    function kontoValidering(konto) {
        if (!isNaN(konto) && konto.length == 4) {
            addKonteringsrad()
            return konto;
        }
        else {
            $('#Meddelande').html('<div class="alert alert-danger"><strong>Fel:</strong> Felaktigt konto!</div>');
        }
    }

    function konteringsrader_init() {
        for (var i = 0; i < 3; i++) {
            addKonteringsrad()
        }
    }

    function addKonteringsrad() {
        var klon = $('.mall:last').clone();
        klon.find('input[type=text]').val(null);
        $('#konteringsrader').append(klon);  
        calcSum(".BFrad");
    }

    function calcSum(kontsum) {
        var bfsum = 0;
        //iterate through each textboxes and add the values
        $(kontsum).each(function () {
            var cellvärde = Beräkningsformat(this.value);
            
            //add only if the value is number
            if (!isNaN(cellvärde) && cellvärde.length != 0) {
                bfsum += parseFloat(cellvärde);
                //$(this).css("background-color", "#FEFFB0");
            }
            else if (cellvärde.length != 0) {
                //$(this).css("background-color", "red");
            }
        });
        $("#BFdiff").val(bfsum.toLocaleString("se", { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }
   
    
    /*
    function calculateSum(BerBlock) {
        var sum = 0;
        //iterate through each textboxes and add the values
        $(BerBlock).each(function () {
            var cellvärde = beräkningsformat(this.value);

            //add only if the value is number
            if (!isNaN(cellvärde) && cellvärde.length != 0) {
                sum += parseFloat(cellvärde);
                // $(this).css("background-color", "#FEFFB0");
            }
            else if (cellvärde.length != 0) {
                // $(this).css("background-color", "red");
            }
        });
    */
</script>

